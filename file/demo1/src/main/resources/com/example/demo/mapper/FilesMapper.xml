<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.mapper.FilesMapper">
  <resultMap id="BaseResultMap" type="com.example.demo.entity.Files">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="FileID" jdbcType="INTEGER" property="fileid" />
    <result column="FileName" jdbcType="VARCHAR" property="filename" />
    <result column="FileType" jdbcType="VARCHAR" property="filetype" />
    <result column="PublisherID" jdbcType="INTEGER" property="publisherid" />
    <result column="PublishTime" jdbcType="TIMESTAMP" property="publishtime" />
  </resultMap>
   <resultMap id="BaseResultMap1" type="com.example.demo.dto.FileUploadDto">
    <id column="SerialNumber" jdbcType="INTEGER" property="serialNumber" />
    <result column="FileName" jdbcType="VARCHAR" property="fileName" />
    <result column="FileType" jdbcType="VARCHAR" property="fileType" />
    <result column="PublisherID" jdbcType="INTEGER" property="publisherId" />
    <result column="FileContent" jdbcType="LONGVARBINARY" property="fileContent" />

  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    FileID, FileName, FileType, PublisherID, PublishTime
  </sql>
  <sql id="Blob_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    FileContent
  </sql>

  <select id="getFilesByRoleAndDepartment" resultMap="BaseResultMap">
    SELECT f.*
    FROM files f
           JOIN filepermissions fp ON f.SerialNumber = fp.FileID
    WHERE fp.PermissionType = #{PermissionType}='SuperAdmin'
       OR(
      fp.DepartmentID = #{departmentId}
        AND (
        #{PermissionType} IN ('DepartmentAdmin', 'HighLevelLeader')
          AND fp.PermissionType IN ('DepartmentAdmin', 'HighLevelLeader', 'MiddleLevelLeader', 'OrdinaryStaff')
          OR (
          #{PermissionType} = 'MiddleLevelLeader'
            AND fp.PermissionType IN ('MiddleLevelLeader', 'OrdinaryStaff')
          )
          OR (
          #{PermissionType} = 'OrdinaryStaff'
            AND fp.PermissionType = 'OrdinaryStaff'
          )
        ))
  </select>
  <select id="selectBySerialNumber" resultMap="BaseResultMap1">
    SELECT f.SerialNumber, f.FileName,fp.DepartmentID,fp.PermissionType, f.FileType, f.PublisherID, f.PublishTime, f.FileContent
    FROM files f
           JOIN filepermissions fp ON  f.SerialNumber= fp.FileID
    WHERE SerialNumber = #{SerialNumber}
  </select>

  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from files
    where FileID = #{fileid,jdbcType=INTEGER}
  </delete>
  <delete id="deleteFileById">
    delete from files where SerialNumber = #{SerialNumber}
  </delete>
  <insert id="insert" parameterType="com.example.demo.entity.Files">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into files (FileID, FileName, FileType, 
      PublisherID, PublishTime, FileContent
      )
    values (#{fileid,jdbcType=INTEGER}, #{filename,jdbcType=VARCHAR}, #{filetype,jdbcType=VARCHAR}, 
      #{publisherid,jdbcType=INTEGER}, #{publishtime,jdbcType=TIMESTAMP}, #{filecontent,jdbcType=LONGVARBINARY}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.example.demo.entity.Files">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into files
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="fileid != null">
        FileID,
      </if>
      <if test="filename != null">
        FileName,
      </if>
      <if test="filetype != null">
        FileType,
      </if>
      <if test="publisherid != null">
        PublisherID,
      </if>
      <if test="publishtime != null">
        PublishTime,
      </if>
      <if test="filecontent != null">
        FileContent,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="fileid != null">
        #{fileid,jdbcType=INTEGER},
      </if>
      <if test="filename != null">
        #{filename,jdbcType=VARCHAR},
      </if>
      <if test="filetype != null">
        #{filetype,jdbcType=VARCHAR},
      </if>
      <if test="publisherid != null">
        #{publisherid,jdbcType=INTEGER},
      </if>
      <if test="publishtime != null">
        #{publishtime,jdbcType=TIMESTAMP},
      </if>
      <if test="filecontent != null">
        #{filecontent,jdbcType=LONGVARBINARY},
      </if>
    </trim>
  </insert>
    <insert id="insertFile">
        insert into files (FileName, FileType, PublisherID, FileContent,SerialNumber)
        values (#{fileName}, #{fileType}, #{publisherId} ,#{fileContent},#{SerialNumber})
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.example.demo.entity.Files">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update files
    <set>
      <if test="filename != null">
        FileName = #{filename,jdbcType=VARCHAR},
      </if>
      <if test="filetype != null">
        FileType = #{filetype,jdbcType=VARCHAR},
      </if>
      <if test="publisherid != null">
        PublisherID = #{publisherid,jdbcType=INTEGER},
      </if>
      <if test="publishtime != null">
        PublishTime = #{publishtime,jdbcType=TIMESTAMP},
      </if>
      <if test="filecontent != null">
        FileContent = #{filecontent,jdbcType=LONGVARBINARY},
      </if>
    </set>
    where FileID = #{fileid,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.example.demo.entity.Files">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update files
    set FileName = #{filename,jdbcType=VARCHAR},
      FileType = #{filetype,jdbcType=VARCHAR},
      PublisherID = #{publisherid,jdbcType=INTEGER},
      PublishTime = #{publishtime,jdbcType=TIMESTAMP},
      FileContent = #{filecontent,jdbcType=LONGVARBINARY}
    where FileID = #{fileid,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.example.demo.entity.Files">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update files
    set FileName = #{filename,jdbcType=VARCHAR},
      FileType = #{filetype,jdbcType=VARCHAR},
      PublisherID = #{publisherid,jdbcType=INTEGER},
      PublishTime = #{publishtime,jdbcType=TIMESTAMP}
    where FileID = #{fileid,jdbcType=INTEGER}
  </update>
  <update id="updateFile" parameterType="com.example.demo.entity.Files">
    UPDATE files
    SET
      FileContent = #{fileContent}
    WHERE SerialNumber = #{SerialNumber}
  </update>
</mapper>